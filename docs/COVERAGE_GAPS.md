# Jest Coverage Report & Gap Analysis

**Generated:** February 13, 2026 4:11 AM UTC  
**Coverage Tool:** Jest with Istanbul  
**Report Location:** `coverage/lcov-report/index.html`

---

## ğŸ“Š Overall Coverage Summary

| Metric | Current | Threshold | Status |
|--------|---------|-----------|--------|
| **Statements** | 34.4% | 80% | âŒ FAILING (-45.6%) |
| **Branches** | 24.91% | 70% | âŒ FAILING (-45.09%) |
| **Lines** | 34.19% | 80% | âŒ FAILING (-45.81%) |
| **Functions** | 31.93% | 80% | âŒ FAILING (-48.07%) |

**Test Suites:** 17 total (10 passed, 7 failed due to coverage thresholds)  
**Tests:** 226 passed, 0 failed  
**Runtime:** 35.146s

---

## âœ… Fully Covered Files (100%)

These files have complete test coverage:

1. **src/lib/value-estimator.ts** - 100% (127 tests)
   - Category detection
   - Value scoring
   - Risk analysis
   - Profit calculations
   - Comparable URL generation

---

## âš ï¸ Files with Partial Coverage (<90%)

### Priority 1: Critical (0% Coverage)

These files have **ZERO** test coverage and need immediate attention:

| File | Coverage | Priority | Complexity |
|------|----------|----------|------------|
| `src/lib/auth-middleware.ts` | 0% | P0 | Medium |
| `src/lib/auth.ts` | 0% | P0 | High |
| `src/lib/crypto.ts` | 0% | P0 | High |
| `src/lib/llm-analyzer.ts` | 0% | P0 | High |
| `src/lib/llm-identifier.ts` | 0% | P0 | High |
| `src/lib/market-price.ts` | 0% | P0 | Medium |
| `src/lib/market-value-calculator.ts` | 0% | P0 | High |
| `src/lib/marketplace-scanner.ts` | 0% | P0 | High |
| `src/lib/theme-config.ts` | 0% | P1 | Low |

### Priority 2: Incomplete Coverage

| File | Coverage | Missing | Priority |
|------|----------|---------|----------|
| `src/lib/claude-analyzer.ts` | 38.2% | 61.8% | P0 |
| `src/lib/image-service.ts` | 68.0% | 32.0% | P1 |
| `src/lib/price-history-service.ts` | 78.0% | 22.0% | P1 |

---

## ğŸ¯ Action Items

### Immediate (P0) - Required for Production

1. **Auth & Security Tests** (Est: 4 hours)
   - [ ] Create `src/__tests__/lib/auth.test.ts`
   - [ ] Create `src/__tests__/lib/auth-middleware.test.ts`
   - [ ] Create `src/__tests__/lib/crypto.test.ts`
   - Cover: JWT generation, token validation, encryption, password hashing

2. **LLM Analysis Tests** (Est: 6 hours)
   - [ ] Create `src/__tests__/lib/llm-analyzer.test.ts`
   - [ ] Create `src/__tests__/lib/llm-identifier.test.ts`
   - Cover: Claude API calls, response parsing, error handling, rate limiting

3. **Market Analysis Tests** (Est: 5 hours)
   - [ ] Create `src/__tests__/lib/market-price.test.ts`
   - [ ] Create `src/__tests__/lib/market-value-calculator.test.ts`
   - [ ] Create `src/__tests__/lib/marketplace-scanner.test.ts`
   - Cover: Price extraction, value calculations, multi-marketplace scanning

4. **Improve Partial Coverage** (Est: 3 hours)
   - [ ] Expand `claude-analyzer.test.ts` (38.2% â†’ 90%)
   - [ ] Expand `image-service.test.ts` (68% â†’ 90%)
   - [ ] Expand `price-history-service.test.ts` (78% â†’ 90%)

### Secondary (P1)

5. **Theme Config Tests** (Est: 1 hour)
   - [ ] Create `src/__tests__/lib/theme-config.test.ts`
   - Cover: Color schemes, theme switching, accessibility

---

## ğŸ“‹ Test Creation Template

For each untested file, create test suite following this structure:

```typescript
/**
 * @jest-environment node
 */
import { describe, test, expect, beforeEach, jest } from '@jest/globals';
import { functionName } from '@/lib/filename';

describe('Module Name', () => {
  beforeEach(() => {
    jest.clearAllMocks();
  });

  describe('functionName', () => {
    test('should handle success case', () => {
      // Arrange
      // Act
      // Assert
    });

    test('should handle error case', () => {
      // Test error handling
    });

    test('should validate inputs', () => {
      // Test input validation
    });
  });
});
```

---

## ğŸ¬ Next Steps

1. **Create Trello cards** for each P0 test suite
2. **Assign story points** based on estimates above
3. **Run coverage** after each test suite: `npm run test:coverage`
4. **Track progress** in this document
5. **Target:** 90% coverage before production deployment

---

## ğŸ“ˆ Coverage Tracking

| Date | Statements | Branches | Lines | Functions | Notes |
|------|-----------|----------|-------|-----------|-------|
| 2026-02-13 | 34.4% | 24.91% | 34.19% | 31.93% | Initial baseline |
| TBD | - | - | - | - | After auth tests |
| TBD | - | - | - | - | After LLM tests |
| TBD | - | - | - | - | After market tests |

**Goal:** 90% across all metrics by Feb 19, 2026

---

## ğŸ”— Resources

- **Coverage Report:** `coverage/lcov-report/index.html`
- **Raw Data:** `coverage/coverage-final.json`
- **LCOV:** `coverage/lcov.info`
- **Run Tests:** `npm run test:coverage`

---

*Generated by ASPEN ğŸŒ² - Flipper AI Task Worker*
